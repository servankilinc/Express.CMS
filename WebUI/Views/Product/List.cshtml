@using Core.Utils.Pagination
@using Model.Entities
@model PaginationResponse<Product>
@{
	ViewData["Title"] = "Ürünler";

	int start = Math.Max(1, Model.Page - 2);
	int end = Math.Min(Model.PageCount, Model.Page + 2);

	Guid productGroupId = ViewBag.ProductGroupId ?? Guid.Empty;
}

<div class="page-title">
	<nav class="breadcrumbs py-4">
		<div class="container">
			<ol>
				<li><a href="/">Ana sayfa</a></li>
				<li class="current">Ürünler</li>
			</ol>
		</div>
	</nav>
</div>

<div class="row">
	<div class="col-12">
		<section id="blog-posts" class="blog-posts section">
			<div class="container-xl">
				<div class="row gy-4">
					@if (Model.Data == null || !Model.Data.Any())
					{
						<h4>Herhangi bir Ürün bulunamamaktadı.</h4>
					}
					else
					{
						@foreach (var product in Model.Data)
						{
							<div class="col-lg-6">
								<article class="d-flex flex-column">
									<div style="height:30vh">
										<img src="@product.Image" alt="@product.Name" style="height: 29vh; width:100%; object-fit:contain;">
									</div>

									<h2 class="title">
										<a asp-controller="urun" asp-action="detay" asp-route-Id="@product.FriendlyUrl">@product.Name</a>
									</h2>

									@if (product.ProductGroup != null)
									{
										<div class="meta-top">
											<ul>
												<li class="d-flex align-items-center">
													<i class="bi bi-tag-fill"></i>
													@product.ProductGroup.Name
												</li>
											</ul>
										</div>
									}

									<div class="content d-flex flex-column justify-content-between h-100">
										<p>
											@if (product.Description != null && product.Description.Length > 200 ){
												@product.Description.Substring(0,200) <span>...</span>
											}
											else if (product.Description != null)
											{
												@product.Description
											}
										</p>
										<div class="read-more">
											<a asp-controller="urun" asp-action="detay" asp-route-Id="@product.FriendlyUrl">
												Detay
												<i class="bi bi-arrow-right ms-2"></i>
											</a>
										</div>
									</div>
								</article>
							</div>

								
							<script type="application/ld+json">
								{
									"@@context": "https://schema.org",
									"@@type": "Ürünlerimiz",
									"name": "@product.Name",
									"image": "@product.Image",
									"url": "@Url.Action("Detail", "Product", new { Id = product.FriendlyUrl }, Context.Request.Scheme)",
									"brand": {
										"@@type": "Brand",
										"name": "Express Bilgisyar"
									}
								}
							</script>
						}	
					}
				</div>
			</div>
		</section>

		@if(Model != null && Model.PageCount > 1)
		{
			<section id="blog-pagination" class="blog-pagination section">
				<div class="container">
					<div class="d-flex justify-content-center">
						<ul>
							@for (int i = start; i <= end; i++)
							{
								if (i == Model.Page)
								{
									<li><a class="active" href="#">@i</a></li>
								}
								else
								{
									<li><a href="@Url.Action("List", new { page = i, productGroupId = productGroupId })">@i</a></li>
								}
							}

							@if (end < Model.PageCount)
							{
								<li>...</li>
								<li><a href="@Url.Action("List", new { page = Model.PageCount, productGroupId = productGroupId })">@Model.PageCount</a></li>
							}
						</ul>
					</div>
				</div>
			</section>
		}

	</div>
</div>