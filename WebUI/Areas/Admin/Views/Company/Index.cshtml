@using WebUI.Areas.Admin.Models.ViewModels.Company_
@model CompanyViewModel
@{
	ViewData["Title"] = "Firmalar";
}

<div class="card">
	<div class="card-header">
		<form id="form_page_filter">
			<div class="row row-gap-4">
				<div class="col-md-4 col-md-6 col-12">
					<div class="input-group">
						<span class="input-group-text bg-lightest">
							Silinenleri Göster
						</span>
						<div class="input-group-text">
							<input name="IsDeleted" type="checkbox" class="form-check-input" />
						</div>
					</div>
				</div>
				<div class="col-md-3 col-sm-4 col-6">
					<button onclick="InitilazeTable(this)" type="button" class="btn btn-light">
						<span class="dynamic-content">
							<i class="fa-solid fa-search me-2"></i>
							Ara
						</span>
					</button>
				</div>
			</div>
		</form>
	</div>
	<div class="card-body">

		<table id="table_page" class="table table-hover table-striped">
			<thead class="bg-light">
				<tr>
					<th>Kuruluş Yılı</th>
					<th>Logo</th>
					<th>Adresler</th>
					<th>Email Adresi</th>
					<th>Telefon Numaraları</th>
					<th>Fax Numaraları</th>
					<th>Çalışma Başlangıç Saati</th>
					<th>Çalışma Bitiş Saati</th>
					<th>Enlem</th>
					<th>Boylam</th>
					<th>GapesJS Lisans</th>
					<th>CkEditor Lisans</th>
					<th>Oluşturma Tarihi</th>
					<th>Son Düzenlenme Tarihi</th>
					<th>Durum</th>
					<th>Silinme Tarihi</th>
					<th>İşlemler</th>
				</tr>
			</thead>
		</table>
	</div>
</div>

@section Scripts {
	<script>

		let PageTable;

		$(document).ready(function(){
			InitilazeTable();
		})

		function InitilazeTable(e) {

			PageTable = DatatableManager.Create({serverSide: true,
				tableId: 'table_page',
				path: 'Company/DatatableServerSide',
				method: 'Post',
				buttonElement: e,

				requestData: {
					filter: {
						operator: 'base',
						logic: 'and',
						filters: [

							{
								operator: 'eq',
								field: "IsDeleted",
								value: false,
								logic: 'or',
								filters: [
									{
										operator: 'eq',
										field: "IsDeleted",
										value: $("input[name='IsDeleted']").val(),
									}
								]
							}

						]
					}
				},
				columns: [
					{data: 'since' },
					{data: 'logo' },
					{data: 'address' },
					{data: 'emailAdresses' },
					{data: 'phoneNumbers' },
					{data: 'faxNumbers' },
					{data: 'workingStartTime' },
					{data: 'workingEndTime' },
					{data: 'latitude' },
					{data: 'longitude' },
					{
						data: 'gapesJSLicenseKey',
						render: function (data) {
							if(data == null) return '';
							return `<button type="button" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="top" title="${data}">${data.substring(0, 20)}</button>`;
						} 
					},
					{
						data: 'ckEditorLicenseKey',
						render: function (data) {
							if(data == null) return '';
							if(data.length < 50) return data;
							return `<button type="button" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="top" title="${data}">${data.substring(0, 20)}...</button>`;
						} 
					},
					{
						data: 'createDateUtc',
						render: function (data) {
							if(data == null) return '';
							return moment(data).format('DD.MM.YYYY HH:mm');
						}
					},
					{
						data: 'updateDateUtc',
						render: function (data) {
							if(data == null) return '';
							return moment(data).format('DD.MM.YYYY HH:mm');
						}
					},
					{
						data: 'isDeleted',
						render: function (data) {
							if(data == true) return (`<span class="badge rounded-pill bg-label-danger"><i class="fa-solid fa-xmark"></i></span>`);
							else if(data == false) return (`<span class="badge rounded-pill bg-label-success"><i class="fa-solid fa-check"></i></span>`);
							else return ('');
						}
					},
					{
						data: 'deletedDateUtc',
						render: function (data) {
							if(data == null) return '';
							return moment(data).format('DD.MM.YYYY HH:mm');
						}
					},
					{
						data: null,
						defaultContent: '',
						searchable: false,
						createdCell: function (td, cellData, rowData, row, col)
						{
							let deleteHandleButton = rowData.isDeleted == true ?
								UIManager.UndoDeleteButtonTable({
									requestUrl: 'Company/UndoDelete',
									requestData: {
										"id": rowData.id
									},
									pageTable:PageTable
								}) :
								UIManager.DeleteButtonTable({
									requestUrl: 'Company/Delete',
									requestData: {
										"id": rowData.id
									},
									pageTable:PageTable
								});

							DatatableManager.AppendRowButtons(td,
								[
									// 1) Update Button
									UIManager.UpdateButtonTable({
										title: "Bilgileri Düzenle",
										formGetterUrl: 'Company/UpdateForm',
										requestData: {
											"id": rowData.id
										},
										pageTable: PageTable
									}),
									// 2) Delete Button
									deleteHandleButton
								]
							);
						}
					}
				],
				customButtons:
				[
					{
						text: '<span class="dynamic-content"><i class="fa-solid fa-file-circle-plus me-2"></i>Yeni Firma Ekle</span>',
						className: 'create-new btn btn-primary mx-2',
						action: (e_btn) =>
						{
							UIManager.InsertModal({
								title: "Yeni Firm Ekle",
								formGetterUrl: 'Company/CreateForm',
								e_btn:e_btn.currentTarget,
								pageTable: PageTable
							})
						}
					}
				]
			})
		}
	</script>
}